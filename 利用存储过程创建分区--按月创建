BEGIN
	  DECLARE ROWS_CNT INT UNSIGNED;
    DECLARE TARGET_DATE TIMESTAMP;
    DECLARE PARTITIONNAME VARCHAR(9);
    DECLARE PARTITION_ADD VARCHAR(9);
    
    SET TARGET_DATE = NOW() + INTERVAL 1 MONTH;
    SET PARTITIONNAME = DATE_FORMAT( TARGET_DATE, 'p%Y%m' );
    SET TARGET_DATE = TARGET_DATE + INTERVAL 1 MONTH;
    SET PARTITION_ADD = DATE_FORMAT( TARGET_DATE, '%Y-%m' );
		SELECT PARTITIONNAME;
		SELECT COUNT(*) INTO ROWS_CNT FROM INFORMATION_SCHEMA.partitions 
		WHERE TABLE_SCHEMA = SCHEMA() AND table_name = IN_TABLENAME AND CONVERT(partition_name USING utf8)=CONVERT(PARTITIONNAME USING utf8);
    SELECT IN_TABLENAME;
    IF ROWS_CNT = 0 THEN
        SET @SQL = CONCAT( 'ALTER TABLE `',IN_TABLENAME, '`',
        ' ADD PARTITION (PARTITION ', PARTITIONNAME, ' VALUES LESS THAN (TO_DAYS(''',
            PARTITION_ADD ,'-01'')));' );
        PREPARE STMT FROM @SQL;
        EXECUTE STMT;
        DEALLOCATE PREPARE STMT;
     ELSE
       SELECT CONCAT("partition `", PARTITIONNAME, "` for table `", IN_TABLENAME, "` already exists") AS result;
     END IF;

END
